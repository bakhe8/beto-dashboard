var p=Object.defineProperty;var b=(i,o,t)=>o in i?p(i,o,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[o]=t;var a=(i,o,t)=>b(i,typeof o!="symbol"?o+"":o,t);import{define as y}from"./runtime.gEiicSNP.js";import{s as v}from"./dom.Bppo_qQO.js";import{s as c}from"./store.FDtkuwoP.js";import{BaseComponent as E}from"./BaseComponent.CGITZmRy.js";import{o as A}from"./events.BRqanfQM.js";const h=["[autofocus]","button","[href]","input:not([type='hidden'])","select","textarea","[tabindex]:not([tabindex='-1'])"].join(", ");class w extends E{constructor(t,e,s){super(t);a(this,"lastActiveElement",null);a(this,"wasOpen",!1);a(this,"unsubscribe",null);a(this,"props");a(this,"slots");a(this,"offEsc",null);this.props=e,this.slots=s,this.on("click",".modal-close, [data-close], .modal-footer button",()=>this.close()),this.unsubscribe=c.on("modal",()=>this.render()),this.render()}close(){const t=c.get("modal");c.set("modal",{...t,open:!1})}trapTab(t){const e=this.root.querySelector(".modal"),s=Array.from((e==null?void 0:e.querySelectorAll(h))||[]);if(t.key==="Tab"&&s.length>0){const r=s[0],n=s[s.length-1];t.shiftKey&&document.activeElement===r?(t.preventDefault(),n.focus()):!t.shiftKey&&document.activeElement===n&&(t.preventDefault(),r.focus())}}render(){var f,u,m;const{open:t,title:e}=c.get("modal");if(!t){this.root.style.display="none",this.root.innerHTML="",(f=this.offEsc)==null||f.call(this),this.wasOpen&&((u=this.lastActiveElement)!=null&&u.focus)&&this.lastActiveElement.focus(),this.wasOpen=!1;return}this.wasOpen||(this.lastActiveElement=document.activeElement||null,this.wasOpen=!0),this.root.style.display="",v(this.root,`
      <div class="modal-overlay">
        <div class="modal" role="dialog" aria-modal="true" aria-labelledby="modal-title" aria-describedby="modal-desc" data-size="${this.props.size||"md"}" tabindex="-1">
          <div class="modal-header">
            <h2 id="modal-title">${e}</h2>
            <button class="modal-close" aria-label="Close">Ã—</button>
          </div>
          <div id="modal-desc" class="modal-body">${this.slots.default||""}</div>
          <div class="modal-footer">${this.slots.footer||""}</div>
        </div>
      </div>
    `),(m=this.offEsc)==null||m.call(this),this.offEsc=A(document,"Escape",l=>{l.preventDefault(),this.close()}),this.effect(()=>()=>{var l;(l=this.offEsc)==null||l.call(this),this.offEsc=null});const s=this.root.querySelector(".modal"),r=Array.from((s==null?void 0:s.querySelectorAll(h))||[]),n=r.find(l=>l.hasAttribute("autofocus"))||r[0]||s;n==null||n.focus();const d=l=>this.trapTab(l);document.addEventListener("keydown",d),this.effect(()=>()=>document.removeEventListener("keydown",d))}destroy(){var t,e;super.destroy(),(t=this.unsubscribe)==null||t.call(this),(e=this.offEsc)==null||e.call(this)}}const L=(i,o,t)=>{const e=new w(i,o,t);return()=>e.destroy()};y("Modal",L);export{L as Modal};
